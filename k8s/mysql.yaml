apiVersion: v1
kind: Service
metadata:
 name: db
 labels:
   app: db
spec:
 type: NodePort
 ports:
 - port: 3306
 selector:
   app: keyist-db
---
apiVersion: apps/v1
kind: Deployment
metadata:
 name: keyist-db
 labels:
   app: keyist-db
spec:
 replicas: 1
 selector:
   matchLabels:
     app: keyist-db
 template:
   metadata:
     labels:
       app: keyist-db
   spec:
     containers:
     - name: keyist-db
       image: mysql:latest
       ports:
       - containerPort: 3306
       volumeMounts:
          - name: db-init #The name(key) value must match pod volumes name(key) value
            mountPath: /docker-entrypoint-initdb.d/script.sql
            subPath: script.sql
       env:
       - name: MYSQL_ROOT_PASSWORD
         value: root
       - name: MYSQL_DATABASE
         value: keyist
       - name: MYSQL_USER
         value: keyistuser
       - name: MYSQL_PASSWORD
         value: keyistpassword
     volumes:
         - name: db-init
           configMap:
             name: db-init
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: db-init
data:
  config.json: |-
    {{ .Files.Get "script.sql" | indent 4 }}
